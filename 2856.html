<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Global  | Secure Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
    <style>
        :root { --bank-blue: #003366; --bank-gold: #c5a059; }
        .bg-bank { background-color: var(--bank-blue); }
        .text-bank-gold { color: var(--bank-gold); }
        .btn-primary { background: linear-gradient(135deg, #003366 0%, #004a99 100%); transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans antialiased text-gray-900">

<header class="bg-bank text-white py-4 px-8 flex justify-between items-center shadow-md border-b-4 border-bank-gold">
    <div class="flex items-center space-x-3">
        <div class="bg-white p-2 rounded-full">
            <i class="fas fa-shield-halved text-bank-blue text-2xl"></i>
        </div>
        <h1 class="text-2xl font-black tracking-tighter italic">APEX<span class="text-bank-gold font-light">GLOBAL</span></h1>
    </div>
</header>

<main class="container mx-auto px-4 py-12 flex flex-col items-center">

    <!-- Registration Section -->
    <section id="regSection" class="w-full max-w-md glass-card rounded-2xl shadow-2xl p-8 border border-gray-100">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-bank-blue">New Account<br>REGISTRATION</h2>
            <p class="text-sm text-gray-500">Join The World's Most Secure Digital Platform.</p>
        </div>
        <div class="space-y-5">
            <input type="text" id="regName" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Legal Full Name">
            <input type="text" id="regUser" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Username">
            <input type="password" id="regPass" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Password">
            <button onclick="handleRegistration()" class="w-full btn-primary text-white font-bold py-4 rounded-lg">initialize registration</button>
            <div class="text-center pt-4">
                <a href="#" onclick="showView('login')" class="text-sm font-bold text-bank-blue hover:underline">Already have an account? Sign In</a>
            </div>
        </div>
    </section>

    <!-- Login Section -->
    <section id="loginSection" class="w-full max-w-md glass-card rounded-2xl shadow-2xl p-8 border border-gray-100 hidden">
        <div class="text-center mb-8">
            <h2 class="text-2xl font-bold text-bank-blue">Account Login</h2>
            <p class="text-sm text-gray-500">Authorized access only.</p>
        </div>
        <div class="space-y-5">
            <input type="text" id="logUser" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Username">
            <input type="password" id="logPass" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Password">
            <button id="loginBtn" onclick="handleLogin()" class="w-full btn-primary text-white font-bold py-4 rounded-lg">Secure Login</button>
            <div class="text-center pt-4">
                <a href="#" onclick="showView('reg')" class="text-sm font-bold text-bank-blue hover:underline">Need an account? Enroll Now</a>
            </div>
        </div>
    </section>

    <!-- Admin Section -->
    <section id="adminSection" class="w-full max-w-3xl glass-card rounded-2xl shadow-2xl p-8 border border-gray-100 hidden">
        <div class="flex justify-between items-center border-b-2 border-bank-gold pb-4 mb-6">
            <h2 class="text-2xl font-bold text-bank-blue">Internal User Registry</h2>
            <button onclick="location.reload()" class="bg-red-600 text-white px-4 py-2 rounded font-bold text-xs">LOGOUT</button>
        </div>
        <div class="overflow-x-auto bg-white rounded-xl shadow-inner">
            <table class="w-full text-left">
                <thead class="bg-gray-100 text-bank-blue uppercase text-xs">
                    <tr>
                        <th class="px-6 py-4">Index</th>
                        <th class="px-6 py-4">Name</th>
                        <th class="px-6 py-4">Username</th>
                    </tr>
                </thead>
                <tbody id="userTableBody" class="divide-y divide-gray-100"></tbody>
            </table>
        </div>
    </section>

    <!-- System Reset (Emergency Fix) -->
    <button onclick="resetSystem()" class="mt-20 text-gray-400 text-xs hover:text-red-500 uppercase tracking-widest">
        <i class="fas fa-sync mr-1"></i>
    </button>

</main>

<script>
const CONFIG = {
    USER: "petersimiyu",
    PASS: "Peter2858",
    DB: "ApexSecure_V5"
};

let db;

async function hash(str) {
    const msgBuffer = new TextEncoder().encode(str);
    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
}

const req = indexedDB.open(CONFIG.DB, 1);
req.onupgradeneeded = e => {
    db = e.target.result;
    if(!db.objectStoreNames.contains("users")) db.createObjectStore("users", { keyPath: "username" });
};
req.onsuccess = e => {
    db = e.target.result;
    seed();
};
req.onerror = () => alert("Database Error. Try a different browser.");

async function seed() {
    const h = await hash(CONFIG.PASS);
    const tx = db.transaction("users", "readwrite");
    tx.objectStore("users").put({ name: "Admin", username: CONFIG.USER, password: h });
}

function showView(v) {
    ['regSection','loginSection','adminSection'].forEach(s => document.getElementById(s).classList.add('hidden'));
    document.getElementById(v+'Section').classList.remove('hidden');
}

async function handleLogin() {
    const u = document.getElementById('logUser').value.trim().toLowerCase();
    const p = document.getElementById('logPass').value;
    const btn = document.getElementById('loginBtn');

    if(!u || !p) return alert("Enter credentials.");
    
    btn.innerText = "Authenticating...";
    btn.disabled = true;

    try {
        const tx = db.transaction("users", "readonly");
        const store = tx.objectStore("users");
        const getReq = store.get(u);

        getReq.onsuccess = async () => {
            const user = getReq.result;
            if(!user) {
                alert("Invalid Username.");
                resetBtn(btn);
                return;
            }

            const h = await hash(p);
            if(h === user.password) {
                if(u === CONFIG.USER) {
                    showView('admin');
                    loadTable();
                } else {
                    window.location.href = "https://summitsolutions28.github.io/Well8372/S1986.html";
                }
            } else {
                alert("Invalid Password.");
                resetBtn(btn);
            }
        };
        
        getReq.onerror = () => { alert("Login logic failed."); resetBtn(btn); };

    } catch (err) {
        alert("System error: " + err);
        resetBtn(btn);
    }
}

function resetBtn(b) {
    b.innerText = "Secure Login";
    b.disabled = false;
}

function loadTable() {
    const tx = db.transaction("users", "readonly");
    tx.objectStore("users").getAll().onsuccess = (e) => {
        document.getElementById('userTableBody').innerHTML = e.target.result.map((u, i) => `
            <tr>
                <td class="px-6 py-4 text-xs">#${i+1}</td>
                <td class="px-6 py-4 font-bold text-bank-blue">${u.name}</td>
                <td class="px-6 py-4 text-gray-500">${u.username}</td>
            </tr>
        `).join('');
    };
}

async function handleRegistration() {
    const n = document.getElementById('regName').value;
    const u = document.getElementById('regUser').value.toLowerCase().trim();
    const p = document.getElementById('regPass').value;
    if(!n || !u || !p) return alert("Required fields missing.");

    const h = await hash(p);
    const tx = db.transaction("users", "readwrite");
    const req = tx.objectStore("users").add({ name: n, username: u, password: h });
    req.onsuccess = () => { alert("Enrolled."); showView('login'); };
    req.onerror = () => alert("Username taken.");
}

function resetSystem() {
    indexedDB.deleteDatabase(CONFIG.DB);
    location.reload();
}
</script>
</body>
</html>
