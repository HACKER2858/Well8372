<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apex Global | Secure Portal</title>

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root { --bank-blue: #003366; --bank-gold: #c5a059; }
.bg-bank { background-color: var(--bank-blue); }
.text-bank-gold { color: var(--bank-gold); }
.btn-primary { background: linear-gradient(135deg, #003366 0%, #004a99 100%); transition: all 0.3s; }
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
.glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
.hidden { display: none !important; }
button:disabled { opacity: 0.6; cursor: not-allowed; }
</style>
</head>

<body class="bg-gray-50 min-h-screen font-sans antialiased text-gray-900">

<header class="bg-bank text-white py-4 px-8 flex justify-between items-center shadow-md border-b-4 border-bank-gold">
<div class="flex items-center space-x-3">
<div class="bg-white p-2 rounded-full">
<i class="fas fa-shield-halved text-bank-blue text-2xl"></i>
</div>
<h1 class="text-2xl font-black tracking-tighter italic">
APEX<span class="text-bank-gold font-light">GLOBAL</span>
</h1>
</div>
</header>

<main class="container mx-auto px-4 py-12 flex flex-col items-center">

<!-- Registration -->
<section id="regSection" class="w-full max-w-md glass-card rounded-2xl shadow-2xl p-8 border border-gray-100">
<div class="text-center mb-8">
<h2 class="text-2xl font-bold text-bank-blue">New Account<br>REGISTRATION</h2>
<p class="text-sm text-gray-500">Join The World's Most Secure Digital Platform.</p>
</div>

<div class="space-y-5">
<input type="text" id="regName" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Legal Full Name">
<input type="text" id="regUser" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Username">
<div class="relative">
<input type="password" id="regPass" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Password">
<span onclick="togglePassword('regPass', this)" class="absolute right-3 top-3 cursor-pointer text-gray-500 text-sm">Show</span>
</div>
<button id="registerBtn" onclick="handleRegistration()" class="w-full btn-primary text-white font-bold py-4 rounded-lg" disabled>
initialize registration
</button>
<div class="text-center pt-4">
<a href="#" onclick="showView('login')" class="text-sm font-bold text-bank-blue hover:underline">
Already have an account? Sign In
</a>
</div>
</div>
</section>

<!-- Login -->
<section id="loginSection" class="w-full max-w-md glass-card rounded-2xl shadow-2xl p-8 border border-gray-100 hidden">
<div class="text-center mb-8">
<h2 class="text-2xl font-bold text-bank-blue">Account Login</h2>
<p class="text-sm text-gray-500">Authorized access only.</p>
</div>
<div class="space-y-5">
<input type="text" id="logUser" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Username">
<div class="relative">
<input type="password" id="logPass" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Password">
<span onclick="togglePassword('logPass', this)" class="absolute right-3 top-3 cursor-pointer text-gray-500 text-sm">Show</span>
</div>
<button id="loginBtn" onclick="handleLogin()" class="w-full btn-primary text-white font-bold py-4 rounded-lg" disabled>
Secure Login
</button>
<div class="text-center pt-2">
<a href="#" onclick="showView('reset')" class="text-xs font-bold text-bank-blue hover:underline">
Forgot Password?
</a>
</div>
<div class="text-center pt-4">
<a href="#" onclick="showView('reg')" class="text-sm font-bold text-bank-blue hover:underline">
Need an account? Enroll Now
</a>
</div>
</div>
</section>

<!-- Reset Password -->
<section id="resetSection" class="w-full max-w-md glass-card rounded-2xl shadow-2xl p-8 border border-gray-100 hidden">
<div class="text-center mb-8">
<h2 class="text-2xl font-bold text-bank-blue">Password Reset</h2>
<p class="text-sm text-gray-500">Enter your username and new password.</p>
</div>
<div class="space-y-5">
<input type="text" id="resetUser" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="Username">
<div class="relative">
<input type="password" id="resetPass" class="w-full p-3 border-2 border-gray-200 rounded-lg" placeholder="New Password">
<span onclick="togglePassword('resetPass', this)" class="absolute right-3 top-3 cursor-pointer text-gray-500 text-sm">Show</span>
</div>
<button id="resetBtn" onclick="handleReset()" class="w-full btn-primary text-white font-bold py-4 rounded-lg" disabled>
Update Password
</button>
<div class="text-center pt-4">
<a href="#" onclick="showView('login')" class="text-sm font-bold text-bank-blue hover:underline">
Back to Login
</a>
</div>
</div>
</section>

<!-- Admin Section (unchanged) -->
<section id="adminSection" class="w-full max-w-3xl glass-card rounded-2xl shadow-2xl p-8 border border-gray-100 hidden">
<div class="flex justify-between items-center border-b-2 border-bank-gold pb-4 mb-6">
<h2 class="text-2xl font-bold text-bank-blue">Internal User Registry</h2>
<button onclick="location.reload()" class="bg-red-600 text-white px-4 py-2 rounded font-bold text-xs">LOGOUT</button>
</div>
<div class="overflow-x-auto bg-white rounded-xl shadow-inner">
<table class="w-full text-left">
<thead class="bg-gray-100 text-bank-blue uppercase text-xs">
<tr>
<th class="px-6 py-4">Index</th>
<th class="px-6 py-4">Name</th>
<th class="px-6 py-4">Username</th>
</tr>
</thead>
<tbody id="userTableBody" class="divide-y divide-gray-100"></tbody>
</table>
</div>
</section>

</main>

<script>
const CONFIG={USER:"petersimiyu",PASS:"Peter2858",DB:"ApexSecure_V5"};
let db;
let dbReady=false;

function enableButtons(){
document.getElementById("registerBtn").disabled=false;
document.getElementById("loginBtn").disabled=false;
document.getElementById("resetBtn").disabled=false;
}

async function hash(str){
const msgBuffer=new TextEncoder().encode(str);
const hashBuffer=await crypto.subtle.digest('SHA-256',msgBuffer);
return Array.from(new Uint8Array(hashBuffer))
.map(b=>b.toString(16).padStart(2,'0')).join('');
}

function validPassword(p){
return p.length>=8 && /[A-Za-z]/.test(p) && /[0-9]/.test(p);
}

function togglePassword(id,el){
const input=document.getElementById(id);
if(input.type==="password"){input.type="text";el.innerText="Hide";}
else{input.type="password";el.innerText="Show";}
}

const request=indexedDB.open(CONFIG.DB,1);

request.onupgradeneeded=e=>{
db=e.target.result;
if(!db.objectStoreNames.contains("users"))
db.createObjectStore("users",{keyPath:"username"});
};

request.onsuccess=e=>{
db=e.target.result;
dbReady=true;
enableButtons();
seedAdmin();
};

request.onerror=()=>alert("Database failed to initialize.");

function seedAdmin(){
const tx=db.transaction("users","readonly");
const getReq=tx.objectStore("users").get(CONFIG.USER);
getReq.onsuccess=async()=>{
if(!getReq.result){
const h=await hash(CONFIG.PASS);
db.transaction("users","readwrite")
.objectStore("users")
.put({name:"Admin",username:CONFIG.USER,password:h});
}
};
}

function showView(v){
['regSection','loginSection','resetSection','adminSection']
.forEach(s=>document.getElementById(s).classList.add('hidden'));
document.getElementById(v+'Section').classList.remove('hidden');
}

async function handleRegistration(){
if(!dbReady) return alert("System initializing. Please wait.");
const n=regName.value;
const u=regUser.value.trim().toLowerCase();
const p=regPass.value;
if(!n||!u||!p) return alert("Required fields missing.");
if(!validPassword(p))
return alert("Password must be at least 8 characters and contain letters and numbers.");
const h=await hash(p);
const tx=db.transaction("users","readwrite");
tx.objectStore("users").add({name:n,username:u,password:h})
.onsuccess=()=>{alert("Enrolled.");showView('login');};
tx.onerror=()=>alert("Username taken.");
}

async function handleLogin(){
if(!dbReady) return alert("System initializing. Please wait.");
const u=logUser.value.trim().toLowerCase();
const p=logPass.value;
if(!u||!p) return alert("Enter credentials.");
const tx=db.transaction("users","readonly");
const getReq=tx.objectStore("users").get(u);
getReq.onsuccess=async()=>{
const user=getReq.result;
if(!user) return alert("Invalid Username.");
if(await hash(p)===user.password){
if(u===CONFIG.USER){showView('admin');loadTable();}
else{window.location.href="https://summitsolutions28.github.io/Well8372/S1986.html";}
}else alert("Invalid Password.");
};
}

function loadTable(){
const tx=db.transaction("users","readonly");
tx.objectStore("users").getAll().onsuccess=e=>{
userTableBody.innerHTML=e.target.result.map((u,i)=>`
<tr>
<td class="px-6 py-4 text-xs">#${i+1}</td>
<td class="px-6 py-4 font-bold text-bank-blue">${u.name}</td>
<td class="px-6 py-4 text-gray-500">${u.username}</td>
</tr>
`).join('');
};
}

async function handleReset(){
if(!dbReady) return alert("System initializing. Please wait.");
const u=resetUser.value.trim().toLowerCase();
const p=resetPass.value;
if(!u||!p) return alert("All fields required.");
if(!validPassword(p))
return alert("Password must be at least 8 characters and contain letters and numbers.");
const tx=db.transaction("users","readwrite");
const store=tx.objectStore("users");
const getReq=store.get(u);
getReq.onsuccess=async()=>{
const user=getReq.result;
if(!user) return alert("Username not found.");
user.password=await hash(p);
store.put(user);
alert("Password updated successfully.");
showView('login');
};
}
</script>

</body>
</html>